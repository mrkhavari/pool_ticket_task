
# پروژه سیستم مدیریت تسک‌ها

این پروژه یک سیستم مدیریت تسک‌ها است که امکان ایجاد، ویرایش، حذف و مشاهده تسک‌ها را فراهم می‌کند.

## نصب

ابتدا باید repository را کلون کنید، سپس وارد فولدر `pool_ticket_task` شوید. پس از آن با دستور زیر یک فایل با نام `.env` بسازید و متغیرهای لازم را مانند فایل `template.env` در آن کپی نمایید. شما می‌توانید این اطلاعات را بنا بر نیاز خود تغییر دهید.

حال با استفاده از دستور زیر می‌توانید برنامه را اجرا نمایید:

```
docker compose up -d --build
```

برای اطمینان از درستی اجرای سرویس‌ها می‌توانید از دستور زیر استفاده نمایید:

```
docker compose ps
```

برای مشاهده اطلاعات هر یک از سرویس‌ها از دستور زیر استفاده نمایید:

```
docker compose logs -f {service_name}
```

به عنوان مثال:

```
docker compose logs -f app
```

پس از اجرای درست سرویس‌ها، می‌توانید به آدرس زیر بروید تا Swagger برنامه را مشاهده کنید:

[http://localhost:8000/docs](http://localhost:8000/docs)

## API ها

### Authentication

کل API ها در دو گروه `Authentication` و `Tasks` دسته‌بندی شده‌اند.

#### 1. `/auth/create` 
این روت یک روت اضافی است که وجود آن اشتباه است، اما چون برنامه در حالت تست قرار دارد، برای راحتی کار ایجاد شده است تا با آن بتوان user ساخت.

#### 2. `/auth/login`
با استفاده از این روت می‌توان وارد برنامه شد و یک توکن دریافت کرد تا در ادامه بتوان از آن استفاده کرد. البته لازم به ذکر است که می‌توان از مستطیل سبز رنگ که در آن کلمه "Authorize" نوشته شده است نیز استفاده کرد تا راحت‌تر باشیم.

### Tasks

در قسمت دوم API ها، ۵ روت داریم:

#### 1. `/tasks/` (POST)
با استفاده از این روت می‌توان تسک جدیدی را ایجاد نمود. لازم به ذکر است که مقدار `title` برای تسک‌ها یکتاست و در صورت ایجاد تسکی با نام تسکی که قبلاً وجود دارد، خطا دریافت می‌کنید. وضعیت تسک (`status`) تنها می‌تواند مقادیر زیر را دریافت کند:
- PENDING
- IN_PROGRESS
- COMPLETED

#### 2. `/tasks/` (GET)
در این روت شما می‌توانید تسک‌ها را بر اساس فیلترهای `status` و `create_at` دریافت کنید. این دو فیلد اختیاری هستند. اگر `created_at` را که به صورت timestamp از کاربر گرفته می‌شود وارد کنید، تسک‌هایی را دریافت می‌کنید که قبل از آن زمان ساخته شده باشند. این روت دارای pagination است که با مقادیر `skip` و `limit` قابل کنترل است. تمامی خروجی‌های این روت بر اساس `create_at` به صورت نزولی مرتب شده‌اند.

#### 3. `/tasks/{task_id}` (GET)
در این روت می‌توانید اطلاعات یک تسک را با وارد کردن `id` آن دریافت کنید. در صورتی که تسک وجود نداشته باشد، خطا دریافت می‌کنید.

#### 4. `/tasks/{task_id}` (PATCH)
در این روت می‌توانید اطلاعات یک تسک را به‌روزرسانی کنید.

#### 5. `/tasks/{task_id}` (DELETE)
با استفاده از این روت می‌توانید یک تسک را پاک کنید.

## ویژگی‌های مهم

### سرویس Celery
این سرویس برای انجام تسک‌های asynchronous ساخته شده است و پس از اینکه یک تسک ساخته شود، یک تابع به صورت Mock اجرا می‌شود که جایگزینی برای کارهایی مانند ارسال email notification است.

### استفاده از Cache
در این برنامه برای روت `/tasks` که با آن می‌توان اطلاعات تسک‌ها را دریافت کرد، از cache استفاده شده است. این سرویس به کمک Redis ایجاد شده است و در صورتی که اطلاعات ورودی روت از قبل در دیتابیس دریافت شده باشد، به جای استفاده از دیتابیس، اطلاعات را از Redis دریافت می‌کند. لازم به ذکر است که در صورت استفاده از روت‌های دیگر مانند create، update و یا delete، این اطلاعات پاک شده و برای request بعدی از دیتابیس استفاده می‌شود.

### استفاده از Alembic
از این کتابخانه برای مدیریت migration های دیتابیس استفاده شده است.

### استفاده از SQLAlchemy
از این کتابخانه به عنوان ORM برای ارتباط با دیتابیس استفاده شده است.

### استفاده از Poetry
در این پروژه برای مدیریت پکیج‌های پایتون از Poetry استفاده شده است.

## ساختار کلی فایل‌های پروژه

در تمام پروژه شما یک ساختار کلی برای تعریف‌های مختلف دارید که در ادامه توضیحات کوتاهی در مورد هر یک داده می‌شود.

### فولدر `app` شامل فایل‌های زیر است:

1. **cache**
   برای مدیریت cache و ذخیره و دریافت از Redis ساخته شده است.

2. **celery**
   برای مدیریت تسک‌های Celery ساخته شده است.

3. **core**
   اطلاعاتی مانند تنظیمات کلی برنامه و متغیرهای ثابت در این قسمت قرار گرفته است.

4. **db**
   برای مدیریت ارتباط با دیتابیس و ساخت session استفاده می‌شود و همچنین ساخت یک کلاس `CRUDBase` برای راحتی کار در استفاده از دیتابیس.

5. **modules**
   در این فولدر ماژول‌های مختلف پروژه قرار دارند. در هر ماژول فولدرهای متفاوتی است که آنها را توضیح می‌دهیم.

   - **dals**: این فولدر که مخفف Data Access Layer است برای زمانی استفاده می‌شود که بخواهیم با دیتابیس ارتباط بگیریم.
   - **helpers**: در این فولدر توابع کمکی ایجاد می‌شود.
   - **models**: در این فولدر مدل‌های دیتابیس به کمک SQLAlchemy ایجاد می‌شود.
   - **routes**: در این فولدر روت‌های مختلف تعریف می‌شود.
   - **schemas**: در این فولدر کلاس‌های ورودی و خروجی توابع و روت‌ها تعریف و مدیریت می‌شود.