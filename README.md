
# Pool Ticket Task

Pool Ticket Task

## نصب

برای نصب و راه‌اندازی پروژه، مراحل زیر را دنبال کنید:

1. ابتدا repository را کلون کنید:
   ```bash
   git clone <repository_url>
   ```

2. وارد فولدر `pool_ticket_task` شوید:
   ```bash
   cd pool_ticket_task
   ```

3. با دستور زیر یک فایل با نام `.env` بسازید و متغیرهای لازم را مانند فایل `template.env` در آن کپی نمایید:
   ```bash
   cp template.env .env
   ```
   شما می‌توانید این اطلاعات را بنا بر نیاز خود تغییر دهید.

4. حال با استفاده از دستور زیر می‌توانید برنامه را اجرا نمایید:
   ```bash
   docker compose up -d --build
   ```

5. برای اطمینان از درستی اجرای سرویس‌ها می‌توانید از دستور زیر استفاده نمایید:
   ```bash
   docker compose ps
   ```

6. برای مشاهده اطلاعات هر یک از سرویس‌ها از دستور زیر استفاده نمایید:
   ```bash
   docker compose logs -f {service_name}
   ```
   به عنوان مثال:
   ```bash
   docker compose logs -f app
   ```

7. پس از اجرای درست سرویس‌ها، می‌توانید به آدرس زیر بروید تا Swagger برنامه را مشاهده کنید:
   ```bash
   http://localhost:8000/docs
   ```

## API ها

کل API ها در دو گروه **Authentication** و **Tasks** دسته‌بندی شده‌اند.

### Authentication
1. **/auth/create**  
   این روت برای ساخت یک user است (روتی اضافی که به صورت موقتی برای راحتی تست در برنامه وجود دارد).

2. **/auth/login**  
   با استفاده از این روت می‌توانید در برنامه ورود کنید و یک token دریافت نمایید. همچنین می‌توانید از دکمه **Authorize** در Swagger برای راحتی استفاده کنید.

### Tasks
1. **/tasks/ (POST)**  
   با استفاده از این روت می‌توانید تسک جدیدی را ایجاد نمایید. مقدار `title` برای تسک‌ها یکتا است و در صورت ایجاد تسکی با نام مشابه، خطا دریافت خواهید کرد. وضعیت تسک (`status`) تنها می‌تواند یکی از مقادیر زیر را دریافت کند:  
   - PENDING  
   - IN_PROGRESS  
   - COMPLETED  

2. **/tasks/ (GET)**  
   با این روت می‌توانید تسک‌ها را بر اساس فیلترهای `status` و `create_at` دریافت کنید. این دو فیلد اختیاری هستند.  
   اگر `created_at` (timestamp) را وارد کنید، تسک‌هایی که قبل از آن زمان ساخته شده‌اند را دریافت خواهید کرد. این روت دارای pagination است که با مقادیر `skip` و `limit` قابل کنترل است. تمامی خروجی‌ها بر اساس `create_at` به صورت نزولی مرتب شده‌اند.

3. **/tasks/{task_id} (GET)**  
   با این روت می‌توانید اطلاعات یک تسک را با وارد کردن `id` آن دریافت کنید. در صورت عدم وجود تسک، خطا دریافت خواهید کرد.

4. **/tasks/{task_id} (PATCH)**  
   با این روت می‌توانید اطلاعات یک تسک را به‌روز‌رسانی کنید.

5. **/tasks/{task_id} (DELETE)**  
   با این روت می‌توانید یک تسک را پاک کنید.

## ویژگی‌های دیگر

- **سرویس Celery**: برای انجام تسک‌های asynchronous ساخته شده است و پس از ایجاد هر تسک، یک تابع به صورت Mock اجرا می‌شود که می‌تواند برای کارهایی مانند ارسال اعلان ایمیل استفاده شود.
  
- **استفاده از Cache**: برای روت `/tasks` که اطلاعات تسک‌ها را دریافت می‌کند، از Redis به عنوان کش استفاده شده است. اگر اطلاعات ورودی روت از قبل در کش ذخیره شده باشد، به جای دیتابیس از Redis استفاده می‌شود.

- **استفاده از Alembic**: از این کتابخانه برای مدیریت migration‌های دیتابیس استفاده شده است.

- **استفاده از SQLAlchemy**: برای ارتباط با دیتابیس از SQLAlchemy به عنوان ORM استفاده شده است.

- **استفاده از Poetry**: برای مدیریت پکیج‌های پایتون در این پروژه از Poetry استفاده شده است.

## ساختار پروژه

### فولدرها و فایل‌ها:

- **/cache**: برای مدیریت کش و ذخیره و دریافت از Redis.
- **/celery**: برای مدیریت تسک‌های Celery.
- **/core**: تنظیمات کلی برنامه و متغیرهای ثابت.
- **/db**: برای مدیریت ارتباط با دیتابیس و ساخت session.
- **/modules**: شامل ماژول‌های مختلف پروژه:
  - **/dals**: برای دسترسی به دیتابیس.
  - **/helpers**: برای توابع کمکی.
  - **/models**: مدل‌های دیتابیس با استفاده از SQLAlchemy.
  - **/routes**: روت‌های مختلف API.
  - **/schemas**: کلاس‌های ورودی و خروجی API.